<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>NBU Exchange Rate Widget</title>
    <script src="https://live.zwidgets.com/js-sdk/1.1/ZohoEmbededAppSDK.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 15px;
            margin: 0;
            font-size: 12px;
        }

        .debug-info {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
        }

        .field-row {
            margin: 5px 0;
            padding: 2px;
            border-bottom: 1px solid #eee;
        }

        .field-name {
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>

<body>
    <div id="content">Завантаження...</div>

    <script>
        let currentRecordId = null;

        ZOHO.embeddedApp.on("PageLoad", function (data) {
            console.log("PageLoad data:", data);
            currentRecordId = data.recordId;
            loadDebugInfo();
        });

        ZOHO.embeddedApp.init();

        async function loadDebugInfo() {
            try {
                // Получаем все данные записи
                const dealResponse = await ZOHO.CRM.API.getRecord({
                    Entity: "Deals",
                    RecordID: currentRecordId
                });

                const dealData = dealResponse.data[0];
                console.log("Все поля сделки:", dealData);

                // Показываем все поля
                let debugHtml = '<div class="debug-info">';
                debugHtml += '<h4>Все поля записи (найдите поле с курсом валют):</h4>';

                Object.keys(dealData).forEach(key => {
                    const value = dealData[key];
                    debugHtml += `<div class="field-row">`;
                    debugHtml += `<span class="field-name">${key}:</span> ${value}`;
                    debugHtml += `</div>`;
                });

                debugHtml += '</div>';

                // Также показываем курс НБУ для проверки
                const nbuResponse = await fetch('https://bank.gov.ua/NBUStatService/v1/statdirectory/exchange?json&valcode=USD');
                const nbuData = await nbuResponse.json();
                const nbuRate = nbuData[0].rate;

                debugHtml += `<div style="margin-top: 20px; padding: 10px; background: #f0f8ff; border: 1px solid #007bff;">`;
                debugHtml += `<strong>Курс НБУ: ${nbuRate.toFixed(2)} ₴</strong>`;
                debugHtml += `</div>`;

                document.getElementById('content').innerHTML = debugHtml;

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('content').innerHTML = `
                    <div style="color: red;">
                        Ошибка: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>

</html>